<!DOCTYPE html>
<html>
	<head>
		<title>Scrollable Demo - Basic</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="http://cdn.kik.com/app/1/default.css">
		<style>
			/*.box .content .scroller {
				width: 100%;
			}
			.box .list .item {
				padding: 2px;
				min-height: 68px;
				color: #444;
				font-size: 24px;
				font-weight: bold;
				line-height: 68px;
				text-shadow: 0 1px 0 #FFF;
			}
			.box .list .item img {
				float: left;
			}
			.box .list .item:nth-child(odd) {
				background: #F7F7F7;
			}*/
img {
	vertical-align: middle;
}
.item {
	height: auto !important;
	line-height: auto !important;
}
		</style>
	</head>

	<body>
		<div class="app-page" data-page="list">
			<div class="app-topbar">
				<div class="app-title">Scrollable Demo</div>
			</div>
			<div class="app-content">
				<ul class="app-list">
				</ul>
			</div>
		</div>

		<div class="app-page" data-page="viewer">
			<div class="app-topbar">
				<div class="app-button left" data-back="true">Back</div>
				<div class="app-title"></div>
			</div>
			<div class="app-content">
				<img />
			</div>
		</div>


		<script src="http://cdn.kik.com/cards/0/cards.js"></script>
<!-- 		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> -->
		<script src="http://cdn.kik.com/app/1/app.js"></script>

		<script src="/zerver/require.js"></script>
		<script src="../src/iscroll.js"      ></script>
		<script src="../src/scrollable.js"   ></script>
		<script src="../src/utils.js"        ></script>
		<script src="../src/scrollWatcher.js"></script>
		<script src="../src/core.js"         ></script>

		<script>
App.populator('list', function (page, data) {
	var list    = page.querySelector('.app-list');
	var content = page.querySelector('.content');
	var categories = ['abstract', 'city', 'people', 'transport', 'animals', 'food', 'nature', 'business', 'nightlife', 'sports', 'cats', 'fashion', 'technics'];

	fillWithExampleItems(list);
// 			content.scrollable();

	function fillWithExampleItems(list, num) {
		num = num || 500;
		for (var i = 0; i < num; i++) {
			list.appendChild(generate(i));
		}
	}

	function generate(i) {
		var li = document.createElement('li');
		li.classList.add('item');

		var text = document.createTextNode("Item " + i);

		var img = document.createElement('img');
		var cat = Math.floor(i / 10) % categories.length;
		var num2 = (i % 10) + 1;
		img.src = getThumbnailURL(
			'http://lorempixel.com/64/64/' + categories[cat] + '/' + num2,
			64, 64, 1.0);
		li.appendChild(img);
		li.appendChild(text);

		Clickable(li);
		li.addEventListener('click', function () {
			App.load('viewer', {
				imgsrc: img.src,
				text: "Item " + i,
			});
		}, false);

		return li;
	}
});

App.populator('viewer', function (page, data) {
	var title = page.querySelector('.app-title');
	var img = page.querySelector('img');

	title.innerText = data.text;
	img.src = data.imgsrc;
});

try {
	App.restore();
} catch (err) {
	App.load('list');
}


/*
	url     = URL of image (must contain a hostname)
	height  = desired height of thumbnail in pixels
	width   = desired width of thumbnail in pixels
	quality = desired quality of thumbnail (values are 0 to 2)

	If only one dimension is specified, aspect ratio will be preserved
	and the thumbnail will be a scaled version of the original.
	If both dimensions are specified, the image will be scaled and
	cropped to the desired dimensions.
*/
function getThumbnailURL (url, height, width, quality) {
	if (!height && !width) {
		throw 'height and/or width must be specified';
	}

	var BASE_URL = 'http://cards-thumbnailer.appspot.com/';
	var thumbURL = BASE_URL;

	thumbURL += encodeURIComponent(url) + '?';

	thumbURL += 'h=' + (height  || '') + '&';
	thumbURL += 'w=' + (width   || '') + '&';
	thumbURL += 'q=' + (quality || 0 );

	return thumbURL;
}

var img = new Image();
img.src = getThumbnailURL('http://somesite.com/mypic.gif', null, 90, 1);
		</script>
	</body>
</html>
